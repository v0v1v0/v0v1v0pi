<div class="container">

<table style="width: 100%;"><tr>
<td>kde</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create (a) kernel density estimate(s)</h2>

<h3>Description</h3>

<p>Creates one or more kernel density estimates using a combination of
the Botev (2010) bandwidth selector and the Abramson (1982)
adaptive kernel bandwidth modifier.
</p>


<h3>Usage</h3>

<pre><code class="language-R">kde(x, ...)

## Default S3 method:
kde(
  x,
  from = NA,
  to = NA,
  bw = NA,
  adaptive = TRUE,
  log = FALSE,
  n = 512,
  plot = TRUE,
  rug = TRUE,
  xlab = "age [Ma]",
  ylab = "",
  kde.col = rgb(1, 0, 1, 0.6),
  hist.col = rgb(0, 1, 0, 0.2),
  show.hist = TRUE,
  bty = "n",
  binwidth = NA,
  hide = NULL,
  nmodes = 0,
  sigdig = 2,
  ...
)

## S3 method for class 'other'
kde(
  x,
  from = NA,
  to = NA,
  bw = NA,
  adaptive = TRUE,
  log = FALSE,
  n = 512,
  plot = TRUE,
  rug = TRUE,
  xlab = "age [Ma]",
  ylab = "",
  kde.col = rgb(1, 0, 1, 0.6),
  hist.col = rgb(0, 1, 0, 0.2),
  show.hist = TRUE,
  bty = "n",
  binwidth = NA,
  hide = NULL,
  nmodes = 0,
  sigdig = 2,
  ...
)

## S3 method for class 'UPb'
kde(
  x,
  from = NA,
  to = NA,
  bw = NA,
  adaptive = TRUE,
  log = FALSE,
  n = 512,
  plot = TRUE,
  rug = TRUE,
  xlab = "age [Ma]",
  ylab = "",
  kde.col = rgb(1, 0, 1, 0.6),
  hist.col = rgb(0, 1, 0, 0.2),
  show.hist = TRUE,
  bty = "n",
  binwidth = NA,
  type = 4,
  cutoff.76 = 1100,
  cutoff.disc = discfilter(),
  common.Pb = 0,
  hide = NULL,
  nmodes = 0,
  sigdig = 2,
  ...
)

## S3 method for class 'detritals'
kde(
  x,
  from = NA,
  to = NA,
  bw = NA,
  adaptive = TRUE,
  log = FALSE,
  n = 512,
  plot = TRUE,
  rug = FALSE,
  xlab = "age [Ma]",
  ylab = "",
  kde.col = rgb(1, 0, 1, 0.6),
  hist.col = rgb(0, 1, 0, 0.2),
  show.hist = TRUE,
  bty = "n",
  binwidth = NA,
  ncol = NA,
  samebandwidth = TRUE,
  normalise = TRUE,
  hide = NULL,
  nmodes = 0,
  sigdig = 2,
  ...
)

## S3 method for class 'PbPb'
kde(
  x,
  from = NA,
  to = NA,
  bw = NA,
  adaptive = TRUE,
  log = FALSE,
  n = 512,
  plot = TRUE,
  rug = TRUE,
  xlab = "age [Ma]",
  ylab = "",
  kde.col = rgb(1, 0, 1, 0.6),
  hist.col = rgb(0, 1, 0, 0.2),
  show.hist = TRUE,
  bty = "n",
  binwidth = NA,
  common.Pb = 2,
  hide = NULL,
  nmodes = 0,
  sigdig = 2,
  ...
)

## S3 method for class 'ArAr'
kde(
  x,
  from = NA,
  to = NA,
  bw = NA,
  adaptive = TRUE,
  log = FALSE,
  n = 512,
  plot = TRUE,
  rug = TRUE,
  xlab = "age [Ma]",
  ylab = "",
  kde.col = rgb(1, 0, 1, 0.6),
  hist.col = rgb(0, 1, 0, 0.2),
  show.hist = TRUE,
  bty = "n",
  binwidth = NA,
  i2i = FALSE,
  hide = NULL,
  nmodes = 0,
  sigdig = 2,
  ...
)

## S3 method for class 'KCa'
kde(
  x,
  from = NA,
  to = NA,
  bw = NA,
  adaptive = TRUE,
  log = FALSE,
  n = 512,
  plot = TRUE,
  rug = TRUE,
  xlab = "age [Ma]",
  ylab = "",
  kde.col = rgb(1, 0, 1, 0.6),
  hist.col = rgb(0, 1, 0, 0.2),
  show.hist = TRUE,
  bty = "n",
  binwidth = NA,
  i2i = FALSE,
  hide = NULL,
  nmodes = 0,
  sigdig = 2,
  ...
)

## S3 method for class 'ThPb'
kde(
  x,
  from = NA,
  to = NA,
  bw = NA,
  adaptive = TRUE,
  log = FALSE,
  n = 512,
  plot = TRUE,
  rug = TRUE,
  xlab = "age [Ma]",
  ylab = "",
  kde.col = rgb(1, 0, 1, 0.6),
  hist.col = rgb(0, 1, 0, 0.2),
  show.hist = TRUE,
  bty = "n",
  binwidth = NA,
  i2i = FALSE,
  hide = NULL,
  nmodes = 0,
  sigdig = 2,
  ...
)

## S3 method for class 'ThU'
kde(
  x,
  from = NA,
  to = NA,
  bw = NA,
  adaptive = TRUE,
  log = FALSE,
  n = 512,
  plot = TRUE,
  rug = TRUE,
  xlab = "age [ka]",
  ylab = "",
  kde.col = rgb(1, 0, 1, 0.6),
  hist.col = rgb(0, 1, 0, 0.2),
  show.hist = TRUE,
  bty = "n",
  binwidth = NA,
  Th0i = 0,
  hide = NULL,
  nmodes = 0,
  sigdig = 2,
  ...
)

## S3 method for class 'ReOs'
kde(
  x,
  from = NA,
  to = NA,
  bw = NA,
  adaptive = TRUE,
  log = FALSE,
  n = 512,
  plot = TRUE,
  rug = TRUE,
  xlab = "age [Ma]",
  ylab = "",
  kde.col = rgb(1, 0, 1, 0.6),
  hist.col = rgb(0, 1, 0, 0.2),
  show.hist = TRUE,
  bty = "n",
  binwidth = NA,
  i2i = TRUE,
  hide = NULL,
  nmodes = 0,
  sigdig = 2,
  ...
)

## S3 method for class 'SmNd'
kde(
  x,
  from = NA,
  to = NA,
  bw = NA,
  adaptive = TRUE,
  log = FALSE,
  n = 512,
  plot = TRUE,
  rug = TRUE,
  xlab = "age [Ma]",
  ylab = "",
  kde.col = rgb(1, 0, 1, 0.6),
  hist.col = rgb(0, 1, 0, 0.2),
  show.hist = TRUE,
  bty = "n",
  binwidth = NA,
  i2i = TRUE,
  hide = NULL,
  nmodes = 0,
  sigdig = 2,
  ...
)

## S3 method for class 'RbSr'
kde(
  x,
  from = NA,
  to = NA,
  bw = NA,
  adaptive = TRUE,
  log = FALSE,
  n = 512,
  plot = TRUE,
  rug = TRUE,
  xlab = "age [Ma]",
  ylab = "",
  kde.col = rgb(1, 0, 1, 0.6),
  hist.col = rgb(0, 1, 0, 0.2),
  show.hist = TRUE,
  bty = "n",
  binwidth = NA,
  i2i = TRUE,
  hide = NULL,
  nmodes = 0,
  sigdig = 2,
  ...
)

## S3 method for class 'LuHf'
kde(
  x,
  from = NA,
  to = NA,
  bw = NA,
  adaptive = TRUE,
  log = FALSE,
  n = 512,
  plot = TRUE,
  rug = TRUE,
  xlab = "age [Ma]",
  ylab = "",
  kde.col = rgb(1, 0, 1, 0.6),
  hist.col = rgb(0, 1, 0, 0.2),
  show.hist = TRUE,
  bty = "n",
  binwidth = NA,
  i2i = TRUE,
  hide = NULL,
  nmodes = 0,
  sigdig = 2,
  ...
)

## S3 method for class 'UThHe'
kde(
  x,
  from = NA,
  to = NA,
  bw = NA,
  adaptive = TRUE,
  log = FALSE,
  n = 512,
  plot = TRUE,
  rug = TRUE,
  xlab = "age [Ma]",
  ylab = "",
  kde.col = rgb(1, 0, 1, 0.6),
  hist.col = rgb(0, 1, 0, 0.2),
  show.hist = TRUE,
  bty = "n",
  binwidth = NA,
  hide = NULL,
  nmodes = 0,
  sigdig = 2,
  ...
)

## S3 method for class 'fissiontracks'
kde(
  x,
  from = NA,
  to = NA,
  bw = NA,
  adaptive = TRUE,
  log = FALSE,
  n = 512,
  plot = TRUE,
  rug = TRUE,
  xlab = "age [Ma]",
  ylab = "",
  kde.col = rgb(1, 0, 1, 0.6),
  hist.col = rgb(0, 1, 0, 0.2),
  show.hist = TRUE,
  bty = "n",
  binwidth = NA,
  hide = NULL,
  nmodes = 0,
  sigdig = 2,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a vector of numbers OR an object of class <code>UPb</code>,
<code>PbPb</code>, <code>ThPb</code>, <code>ArAr</code>, <code>KCa</code>, <code>ReOs</code>,
<code>SmNd</code>, <code>RbSr</code>, <code>UThHe</code>, <code>fissiontracks</code>,
<code>ThU</code> or <code>detrital</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>optional arguments to be passed on to <code>R</code>'s
<code>density</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>from</code></td>
<td>
<p>minimum age of the time axis. If <code>NULL</code>, this is
set automatically</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>to</code></td>
<td>
<p>maximum age of the time axis. If <code>NULL</code>, this is set
automatically</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bw</code></td>
<td>
<p>the bandwidth of the KDE. If <code>NULL</code>, <code>bw</code> will
be calculated automatically using the algorithm by Botev et
al. (2010).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adaptive</code></td>
<td>
<p>logical flag controlling if the adaptive KDE
modifier of Abramson (1982) is used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log</code></td>
<td>
<p>transform the ages to a log scale if <code>TRUE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>horizontal resolution (i.e., the number of segments) of
the density estimate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>show the KDE as a plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rug</code></td>
<td>
<p>add a rug plot?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab</code></td>
<td>
<p>the x-axis label</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab</code></td>
<td>
<p>the y-axis label</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kde.col</code></td>
<td>
<p>the fill colour of the KDE specified as a four
element vector of <code>r, g, b, alpha</code> values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hist.col</code></td>
<td>
<p>the fill colour of the histogram specified as a
four element vector of <code>r, g, b, alpha</code> values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show.hist</code></td>
<td>
<p>logical flag indicating whether a histogram should
be added to the KDE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bty</code></td>
<td>
<p>change to <code>"o"</code>, <code>"l"</code>, <code>"7"</code>,
<code>"c"</code>, <code>"u"</code>, or <code>"]"</code> if you want to draw a box
around the plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>binwidth</code></td>
<td>
<p>scalar width of the histogram bins, in Myr if
<code>log = FALSE</code>, or as a fractional value if <code>log =
TRUE</code>. Sturges' Rule (<code class="reqn">\log_2[n]+1</code>, where <code class="reqn">n</code> is the
number of data points) is used if <code>binwidth = NA</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hide</code></td>
<td>
<p>vector with indices of aliquots that should be removed
from the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nmodes</code></td>
<td>
<p>label the <code>nmodes</code> most prominent modes of the
distribution. Change to <code>'all'</code> to label all the modes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigdig</code></td>
<td>
<p>the number of significant digits to which the modes
should be labelled. Only used if <code>nmodes</code> is a positive
integer or <code>'all'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>scalar indicating whether to plot the
<code class="reqn">^{207}</code>Pb/<code class="reqn">^{235}</code>U age (<code>type</code>=1), the
<code class="reqn">^{206}</code>Pb/<code class="reqn">^{238}</code>U age (<code>type</code>=2), the
<code class="reqn">^{207}</code>Pb/<code class="reqn">^{206}</code>Pb age (<code>type</code>=3), the
<code class="reqn">^{207}</code>Pb/<code class="reqn">^{206}</code>Pb-<code class="reqn">^{206}</code>Pb/<code class="reqn">^{238}</code>U age
(<code>type</code>=4), the concordia_age (<code>type</code>=5), or the
<code class="reqn">^{208}</code>Pb/<code class="reqn">^{232}</code>Th age (<code>type</code>=6).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff.76</code></td>
<td>
<p>the age (in Ma) below which the
<code class="reqn">^{206}</code>Pb/<code class="reqn">^{238}</code>U and above which the
<code class="reqn">^{207}</code>Pb/<code class="reqn">^{206}</code>Pb age is used. This parameter is
only used if <code>type=4</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff.disc</code></td>
<td>
<p>discordance cutoff filter. This is an object of
class <code>discfilter</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>common.Pb</code></td>
<td>
<p>common lead correction:
</p>
<p><code>0</code>: none
</p>
<p><code>1</code>: use the Pb-composition stored in
</p>
<p><code>settings('iratio','Pb207Pb206')</code> (if <code>x</code> has class
<code>UPb</code> and <code>x$format&lt;4</code>);
</p>
<p><code>settings('iratio','Pb206Pb204')</code> and
<code>settings('iratio','Pb207Pb204')</code> (if <code>x</code> has class
<code>PbPb</code> or <code>x</code> has class <code>UPb</code> and
<code>3&lt;x$format&lt;7</code>); or
</p>
<p><code>settings('iratio','Pb206Pb208')</code> and
<code>settings('iratio','Pb207Pb208')</code> (if <code>x</code> has class
<code>UPb</code> and <code>x$format=7,8</code>).
</p>
<p><code>2</code>: use the isochron intercept as the initial Pb-composition
</p>
<p><code>3</code>: use the Stacey-Kramers two-stage model to infer the
initial Pb-composition (only valid if <code>x</code> has class
<code>UPb</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncol</code></td>
<td>
<p>scalar value indicating the number of columns over
which the KDEs should be divided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>samebandwidth</code></td>
<td>
<p>logical flag indicating whether the same
bandwidth should be used for all samples. If
<code>samebandwidth = TRUE</code> and <code>bw = NULL</code>, then the
function will use the median bandwidth of all the samples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>normalise</code></td>
<td>
<p>logical flag indicating whether or not the KDEs
should all integrate to the same value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i2i</code></td>
<td>
<p>‘isochron to intercept’: calculates the initial (aka
‘inherited’, ‘excess’, or ‘common’)
<code class="reqn">^{40}</code>Ar/<code class="reqn">^{36}</code>Ar, <code class="reqn">^{40}</code>Ca/<code class="reqn">^{44}</code>Ca,
<code class="reqn">^{207}</code>Pb/<code class="reqn">^{204}</code>Pb, <code class="reqn">^{87}</code>Sr/<code class="reqn">^{86}</code>Sr,
<code class="reqn">^{143}</code>Nd/<code class="reqn">^{144}</code>Nd, <code class="reqn">^{187}</code>Os/<code class="reqn">^{188}</code>Os,
<code class="reqn">^{230}</code>Th/<code class="reqn">^{232}</code>Th, <code class="reqn">^{176}</code>Hf/<code class="reqn">^{177}</code>Hf or
<code class="reqn">^{204}</code>Pb/<code class="reqn">^{208}</code>Pb ratio from an isochron
fit. Setting <code>i2i</code> to <code>FALSE</code> uses the default values
stored in <code>settings('iratio',...)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Th0i</code></td>
<td>
<p>initial <code class="reqn">^{230}</code>Th correction.
</p>
<p><code>0</code>: no correction
</p>
<p><code>1</code>: project the data along an isochron fit
</p>
<p><code>2</code>: if <code>x$format</code> is <code>1</code> or <code>2</code>, correct the
data using the measured present day <code class="reqn">^{230}</code>Th/<code class="reqn">^{238}</code>U,
<code class="reqn">^{232}</code>Th/<code class="reqn">^{238}</code>U and <code class="reqn">^{234}</code>U/<code class="reqn">^{238}</code>U
activity ratios in the detritus. If <code>x$format</code> is <code>3</code> or
<code>4</code>, correct the data using the measured
<code class="reqn">^{238}</code>U/<code class="reqn">^{232}</code>Th activity ratio of the whole rock, as
stored in <code>x</code> by the <code>read.data()</code> function.
</p>
<p><code>3</code>: correct the data using an assumed initial
<code class="reqn">^{230}</code>Th/<code class="reqn">^{232}</code>Th-ratio for the detritus (only relevant
if <code>x$format</code> is <code>1</code> or <code>2</code>).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Given a set of <code class="reqn">n</code> age estimates <code class="reqn">\{t_1, t_2, ..., t_n\}</code>,
histograms and KDEs are probability density estimators that display
age distributions by smoothing.  Histograms do this by grouping the
data into a number of regularly spaced bins.  Alternatively, kernel
density estimates (KDEs; Vermeesch, 2012) smooth data by applying a
(Gaussian) kernel:
</p>
<p><code class="reqn">KDE(t) = \sum_{i=1}^{n}N(t|\mu=t_i,\sigma=h[t])/n</code>
</p>
<p>where <code class="reqn">N(t|\mu,\sigma)</code> is the probability of observing a value
<code class="reqn">t</code> under a Normal distribution with mean <code class="reqn">\mu</code> and
standard deviation <code class="reqn">\sigma</code>.  <code class="reqn">h[t]</code> is the smoothing
parameter or ‘bandwidth’ of the kernel density estimate, which may
or may not depend on the age <code class="reqn">t</code>. If <code class="reqn">h[t]</code> depends on
<code class="reqn">t</code>, then <code class="reqn">KDE(t)</code> is known as an ‘adaptive’ KDE.  The
default bandwidth used by <code>IsoplotR</code> is calculated using the
algorithm of Botev et al. (2010) and modulated by the adaptive
smoothing approach of Abramson (1982).  The rationale behind
adaptive kernel density estimation is to use a narrower bandwidth
near the peaks of the sampling distribution (where the ordered
dates are closely spaced in time), and a wider bandwidth in the
distribution's sparsely sampled troughs. Thus, the resolution of
the density estimate is optimised according to data availability.
</p>


<h3>Value</h3>

<p>If <code>x</code> has class <code>UPb</code>, <code>PbPb</code>, <code>ArAr</code>,
<code>KCa</code>, <code>ReOs</code>, <code>SmNd</code>, <code>RbSr</code>,
<code>UThHe</code>, <code>fissiontracks</code> or <code>ThU</code>, returns an
object of class <code>KDE</code>, i.e. a list containing the
following items:
</p>

<dl>
<dt>x</dt>
<dd>
<p> horizontal plot coordinates</p>
</dd>
<dt>y</dt>
<dd>
<p> vertical plot coordinates</p>
</dd>
<dt>bw</dt>
<dd>
<p> the base bandwidth of the density estimate</p>
</dd>
<dt>ages</dt>
<dd>
<p> the data values from the input to
the <code>kde</code> function</p>
</dd>
<dt>log</dt>
<dd>
<p> copied from the input</p>
</dd>
<dt>modes</dt>
<dd>
<p>a two-column matrix with the <code>x</code> and <code>y</code>
values of the <code>nmodes</code> most prominent modes. Only returned
if <code>nmodes</code> is a positive integer or <code>'all'</code>.</p>
</dd>
<dt>h</dt>
<dd>
<p> an object of class <code>histogram</code>.
Only returned if <code>show.hist</code> is <code>TRUE</code></p>
</dd>
</dl>
<p>or, if <code>x</code> has class <code>=detritals</code>, an object of class
<code>KDEs</code>, i.e. a list containing the following items:
</p>

<dl>
<dt>kdes</dt>
<dd>
<p>a named list with objects of class <code>KDE</code></p>
</dd>
<dt>from</dt>
<dd>
<p>the beginning of the common time scale</p>
</dd>
<dt>to</dt>
<dd>
<p>the end of the common time scale</p>
</dd>
<dt>themax</dt>
<dd>
<p>the maximum probability density of all the KDEs</p>
</dd>
<dt>xlabel</dt>
<dd>
<p>the x-axis label to be used by <code>plot.KDEs(...)</code></p>
</dd>
</dl>
<h3>References</h3>

<p>Abramson, I.S., 1982. On bandwidth variation in kernel estimates-a
square root law. The annals of Statistics, pp.1217-1223.
</p>
<p>Botev, Z. I., J. F. Grotowski, and
D. P. Kroese. "Kernel density estimation via diffusion." The Annals
of Statistics 38.5 (2010): 2916-2957.
</p>
<p>Vermeesch, P., 2012. On the visualisation of detrital age
distributions. Chemical Geology, 312, pp.190-194.
</p>


<h3>See Also</h3>

<p><code>radialplot</code>, <code>cad</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">kde(examples$UPb)

dev.new()
kde(examples$FT1,log=TRUE)

dev.new()
kde(examples$DZ,from=1,to=3000,kernel="epanechnikov")
</code></pre>


</div>