<div class="container">

<table style="width: 100%;"><tr>
<td>SHIdat</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
A real example dataset from the randomized clinical trial SHIVA
</h2>

<h3>Description</h3>

<p>Dataset SHIdat contains an anonymized excerpt of data from the SHIVA01 trial. This was the first randomized cli,ical trial that aimed at comparing molecularly targeted therapy based on tumour profiling (MTA) versus conventiona therapy (CT) for advanced cancer. A switch to the other arm was scheduled to be proposed at disease progression for patients in both treatment groups.
</p>


<h3>Usage</h3>

<pre><code class="language-R">data("SHIdat")</code></pre>


<h3>Format</h3>

<p>A data frame with 197 observations on the following 306 variables.
</p>

<dl>
<dt><code>id</code></dt>
<dd>
<p>a numeric vector corresponding to the patient's identifier</p>
</dd>
<dt><code>bras.f</code></dt>
<dd>
<p>a vector containing the patient's randomized arm</p>
</dd>
<dt><code>agerand</code></dt>
<dd>
<p>a numeric vector containing patient's age (in years) at randomization</p>
</dd>
<dt><code>sex.f</code></dt>
<dd>
<p>a vector containing the patient's gender</p>
</dd>
<dt><code>tt_Lnum</code></dt>
<dd>
<p>a numeric vector containing the number of previous lines of treatment</p>
</dd>
<dt><code>rmh_alea.c</code></dt>
<dd>
<p>a numeric vector containing  the Royal Marsden Hospital score segregated into two categories</p>
</dd>
<dt><code>pathway.f</code></dt>
<dd>
<p>a vector the molecular pathway altered (pathway.f: the hormone receptors pathway, the PI3K/ AKT/mTOR pathway, and the RAF/MEK pathway) </p>
</dd>
<dt>
<code>myps.v2</code>,<code>ps.v3</code>,<code>ps1.v1</code>,<code>ps1.v2</code>,<code>ps1.v3</code>,<code>ps1.v4</code>,<code>ps1.v5</code>,<code>ps1.v6</code>,<code>ps1.v7</code>,<code>ps1.v8</code>,<code>ps1.v9</code>,<code>ps1.v10</code>,<code>ps1.v11</code>,<code>ps1.v12</code>, <code>ps1.v13</code>,<code>ps1.v14</code>,<code>ps1.v15</code>,<code>ps1.v16</code>,<code>ps1.v17</code>,<code>ps1.v18</code>,<code>ps1.v19</code>,<code>ps1.v20</code>, <code>ps1.v21</code>
</dt>
<dd>
<p>numeric vectors containing the ECOG performance status measured at the randomization visit, the visit before the potential switch and the planned visits (maximum number of planned visits: 21)</p>
</dd>
<dt>
<code>mytran.v1</code>,<code>tran.v2</code>,<code>tran.v3</code>,<code>tran.v4</code>,<code>tran.v5</code>,<code>tran.v6</code>,<code>tran.v7</code>,<code>tran.v8</code>,<code>tran.v9</code>,<code>tran.v10</code>,<code>tran.v11</code>,<code>tran.v12</code>, <code>tran.v13</code>,<code>tran.v14</code>,<code>tran.v15</code>,<code>tran.v16</code>,<code>tran.v17</code>,<code>tran.v18</code>,<code>tran.v19</code>,<code>tran.v20</code>,<code>tran.v21</code>
</dt>
<dd>
<p>numeric vectors containing the use of platelet transfusions at each of the potential 21 planned visits</p>
</dd>
<dt>
<code>myttc.v2</code>,<code>ttc.v3</code>,<code>ttc1.v1</code>,<code>ttc1.v2</code>,<code>ttc1.v3</code>,<code>ttc1.v4</code>,<code>ttc1.v5</code>,<code>ttc1.v6</code>,<code>ttc1.v7</code>,<code>ttc1.v8</code>,<code>ttc1.v9</code>,<code>ttc1.v10</code>, <code>ttc1.v11</code>,<code>ttc1.v12</code>,<code>ttc1.v13</code>,<code>ttc1.v14</code>,<code>ttc1.v15</code>,<code>ttc1.v16</code>,<code>ttc1.v17</code>,<code>ttc1.v18</code>,<code>ttc1.v19</code>,<code>ttc1.v20</code>, <code>ttc1.v21</code>
</dt>
<dd>
<p>numeric vectors containing the presence of concomitant treatments at the randomization visit, the visit before the potential switch and the planned visits (maximum number of planned visits: 21)</p>
</dd>
<dt>
<code>tox.t1</code>,<code>tox.t2</code>,<code>tox.t3</code>,<code>tox.t4</code>,<code>tox.t5</code>,<code>tox.t6</code>,<code>tox.t7</code>,<code>tox.t8</code>,<code>tox.t9</code>,<code>tox.t10</code>,<code>tox.t11</code>,<code>tox.t12</code>,<code>tox.t13</code>,<code>tox.t14</code>, <code>tox.t15</code>,<code>tox.t16</code>,<code>tox.t17</code>,<code>tox.t18</code>,<code>tox.t19</code>,<code>tox.t20</code>,<code>tox.t21</code>,<code>tox.t22</code>,<code>tox.t23</code>,<code>tox.t24</code>,<code>tox.t25</code>,<code>tox.t26</code>, <code>tox.t27</code>,<code>tox.t28</code>,<code>tox.t29</code>,<code>tox.t30</code>,<code>tox.t31</code>,<code>tox.t32</code>,<code>tox.t33</code>,<code>tox.t34</code>,<code>tox.t35</code>,<code>tox.t36</code>,<code>tox.t37</code>,<code>tox.t38</code>, <code>tox.t39</code>,<code>tox.t40</code>,<code>tox.t41</code>,<code>tox.t42</code>,<code>tox.t43</code>,<code>tox.t44</code>,<code>tox.t45</code>,<code>tox.t46</code>,<code>tox.t47</code>,<code>tox.t48</code>,<code>tox.t49</code>,<code>tox.t50</code>, <code>tox.t51</code>,<code>tox.t52</code>,<code>tox.t53</code>,<code>tox.t54</code>,<code>tox.t55</code>,<code>tox.t56</code>,<code>tox.t57</code>,<code>tox.t58</code>,<code>tox.t59</code>,<code>tox.t60</code>,<code>tox.t61</code>,<code>tox.t62</code>, <code>tox.t63</code>,<code>tox.t64</code>,<code>tox.t65</code>,<code>tox.t66</code>,<code>tox.t67</code>,<code>tox.t68</code>,<code>tox.t69</code>,<code>tox.t70</code>,<code>tox.t71</code>,<code>tox.t72</code>,<code>tox.t73</code>,<code>tox.t74</code>, <code>tox.t75</code>,<code>tox.t76</code>,<code>tox.t77</code>,<code>tox.t78</code>,<code>tox.t79</code>,<code>tox.t80</code>,<code>tox.t81</code>,<code>tox.t82</code>,<code>tox.t83</code>,<code>tox.t84</code>,<code>tox.t85</code>,<code>tox.t86</code>, <code>tox.t87</code>,<code>tox.t88</code>,<code>tox.t89</code>,<code>tox.t90</code>,<code>tox.t91</code>,<code>tox.t92</code>,<code>tox.t93</code>,<code>tox.t94</code>,<code>tox.t95</code>,<code>tox.t96</code>,<code>tox.t97</code>,<code>tox.t98</code>, <code>tox.t99</code>, <code>tox.t100</code>
</dt>
<dd>
<p>numeric vectors corresponding to the presence of an adveerse event. <code>tox.ti</code> contains 1 if the patient started an adverse event linked with the treatment at <code>datetox.ti</code>, 0 if the patient ended an adverse event linked with the treatment at <code>datetox.ti</code>, and NA otherwise</p>
</dd>
<dt><code>ddn</code></dt>
<dd>
<p>a vector containing the date of latest news</p>
</dd>
<dt><code>debttCO</code></dt>
<dd>
<p>a vector containing the date of initiation of the other arm treatment</p>
</dd>
<dt><code>ddeath</code></dt>
<dd>
<p>a vector containg the death date</p>
</dd>
<dt><code>ddt.v1</code></dt>
<dd>
<p>a vector containing the date of initiation of the randomized treatment</p>
</dd>
<dt><code>datt</code></dt>
<dd>
<p>a vector containing the date of the interruption of the randomized treatment</p>
</dd>
<dt><code>dexac.v2</code></dt>
<dd>
<p>a vector containing the date of randomization</p>
</dd>
<dt><code>dexac.v3</code></dt>
<dd>
<p>a vector containing the date of the visit before the potential switch</p>
</dd>
<dt>
<code>dexac1.v1</code>,<code>dexac1.v2</code>,<code>dexac1.v3</code>,<code>dexac1.v4</code>,<code>dexac1.v5</code>,<code>dexac1.v6</code>,<code>dexac1.v7</code>,<code>dexac1.v8</code>,<code>dexac1.v9</code>, <code>dexac1.v10</code>,<code>dexac1.v11</code>,<code>dexac1.v12</code>,<code>dexac1.v13</code>,<code>dexac1.v14</code>,<code>dexac1.v15</code>,<code>dexac1.v16</code>,<code>dexac1.v17</code>, <code>dexac1.v18</code>,<code>dexac1.v19</code>,<code>dexac1.v20</code>, <code>dexac1.v21</code>
</dt>
<dd>
<p>vectors containing the dates of the potential 21 planned visits</p>
</dd>
<dt>
<code>datetox.t1</code>,<code>datetox.t2</code>,<code>datetox.t3</code>,<code>datetox.t4</code>,<code>datetox.t5</code>,<code>datetox.t6</code>,<code>datetox.t7</code>,<code>datetox.t8</code>, <code>datetox.t9</code>,<code>datetox.t10</code>,<code>datetox.t11</code>,<code>datetox.t12</code>,<code>datetox.t13</code>,<code>datetox.t14</code>,<code>datetox.t15</code>, <code>datetox.t16</code>,<code>datetox.t17</code>,<code>datetox.t18</code>,<code>datetox.t19</code>,<code>datetox.t20</code>,<code>datetox.t21</code>,<code>datetox.t22</code>, <code>datetox.t23</code>,<code>datetox.t24</code>,<code>datetox.t25</code>,<code>datetox.t26</code>,<code>datetox.t27</code>,<code>datetox.t28</code>,<code>datetox.t29</code>, <code>datetox.t30</code>,<code>datetox.t31</code>,<code>datetox.t32</code>,<code>datetox.t33</code>,<code>datetox.t34</code>,<code>datetox.t35</code>,<code>datetox.t36</code>, <code>datetox.t37</code>,<code>datetox.t38</code>,<code>datetox.t39</code>,<code>datetox.t40</code>,<code>datetox.t41</code>,<code>datetox.t42</code>,<code>datetox.t43</code>, <code>datetox.t44</code>,<code>datetox.t45</code>,<code>datetox.t46</code>,<code>datetox.t47</code>,<code>datetox.t48</code>,<code>datetox.t49</code>,<code>datetox.t50</code>, <code>datetox.t51</code>,<code>datetox.t52</code>,<code>datetox.t53</code>,<code>datetox.t54</code>,<code>datetox.t55</code>,<code>datetox.t56</code>,<code>datetox.t57</code>, <code>datetox.t58</code>,<code>datetox.t59</code>,<code>datetox.t60</code>,<code>datetox.t61</code>,<code>datetox.t62</code>,<code>datetox.t63</code>,<code>datetox.t64</code>, <code>datetox.t65</code>,<code>datetox.t66</code>,<code>datetox.t67</code>,<code>datetox.t68</code>,<code>datetox.t69</code>,<code>datetox.t70</code>,<code>datetox.t71</code>, <code>datetox.t72</code>,<code>datetox.t73</code>,<code>datetox.t74</code>,<code>datetox.t75</code>,<code>datetox.t76</code>,<code>datetox.t77</code>,<code>datetox.t78</code>, <code>datetox.t79</code>,<code>datetox.t80</code>,<code>datetox.t81</code>,<code>datetox.t82</code>,<code>datetox.t83</code>,<code>datetox.t84</code>,<code>datetox.t85</code>, <code>datetox.t86</code>,<code>datetox.t87</code>,<code>datetox.t88</code>,<code>datetox.t89</code>,<code>datetox.t90</code>,<code>datetox.t91</code>,<code>datetox.t92</code>, <code>datetox.t93</code>,<code>datetox.t94</code>,<code>datetox.t95</code>,<code>datetox.t96</code>,<code>datetox.t97</code>,<code>datetox.t98</code>,  <code>datetox.t99</code>, <code>datetox.t100</code>
</dt>
<dd>
<p>vectors containing the dates related to adverse events (as explained above)</p>
</dd>
<dt><code>CO</code></dt>
<dd>
<p>a vector containing 1 if the patient changed treatment arm (i.e., did a switch)</p>
</dd>
<dt><code>progDate</code></dt>
<dd>
<p>a vector containing the date of a potential progression</p>
</dd>
<dt><code>progStatus</code></dt>
<dd>
<p>a vector containing 1 if the patient did a progression (and 0 otherwise)</p>
</dd>
<dt><code>status</code></dt>
<dd>
<p>a vector containing the patient's status at the date of latest news (1 if died, 0 otherwise)</p>
</dd>
</dl>
<h3>Details</h3>

<p>Note that some variables were built from the original data for illustration purpose. We provided an excerpt containing only the covariates that are useful for our analysis. Note also that the SHIVA data were anonymized.
</p>
<p>Acknowledgments: we thank the patients who volunteered to participate in this study for their dedication and the study-site staff who cared for them. This work is supported by grant ANR-10-EQPX-03 from the Agence Nationale de la Recherche (Investissements d'avenir) and Site de Recherche Integre contre le Cancer (SiRIC). High-throughput sequencing was done by the NGS platform of the Institut Curie, supported by grants ANR-10-EQPX-03 and ANR-10-INBS-09-08 from the Agence Nationale de la Recherche (Investissements d'avenir) and the Canceropole Ile-de-France.
</p>


<h3>References</h3>

<p>Le Tourneau, C., Delord, J. P., Goncalves, A., et al. (2015). "Molecularly targeted therapy based on tumour molecular profiling versus conventional therapy for advanced cancer (SHIVA): a multicentre, open-label, proof-of-concept, randomised, controlled phase 2 trial". The Lancet Oncology, 16(13), 1324-1334. doi : "10.1016/S1470-2045(15)00188-6"
</p>
<p>Graffeo, N., Latouche, A., Le Tourneau C., Chevret, S. (2019) "ipcwswitch: an R package for inverse probability of censoring weighting with an application to switches in clinical trials". Computers in biology and medicine, 111, 103339. doi : "10.1016/j.compbiomed.2019.103339"
</p>


<h3>See Also</h3>

<p><code>cens.ipw</code>, <code>ipcw</code>, <code>replicRows</code>, <code>timesTokeep</code>, <code>wideToLongTDC</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# To obtain the times parameter, we can apply the timesTokeep function on the same
# dataframe in the wide format
# names of the repeated measurements
vect.ps   &lt;- c("myps.v2", "ps.v3", c(paste("ps1.v", seq(1,21), sep="")))
vect.ttc  &lt;- c("myttc.v2", "ttc.v3", c(paste("ttc1.v", seq(1,21), sep="")))
vect.tran &lt;- c("mytran.v1", paste("tran.v", seq(2,21), sep=""))
# corresponding dates
dates &lt;- c("dexac.v2", "dexac.v3", c(paste("dexac1.v", seq(21), sep="")))
dates2 &lt;- dates[!(dates %in% c("dexac.v2","dexac.v3"))]

# times to keep
kept.t &lt;- timesTokeep(SHIdat, id = "id",
                      tstart = "dexac.v2", tstop = "ddn",
                      mes.cov = list(vect.ps, vect.ttc, vect.tran),
                      time.cov = list(dates, dates, dates2))
# Now, we can build the long format
SHIlong &lt;- wideToLongTDC(SHIdat, id = "id",
                         tstart = "dexac.v2", tstop = "ddn",
                         event = "status",
                         bas.cov = c("agerand", "sex.f","tt_Lnum", "rmh_alea.c", "pathway.f",
                         "bras.f","debttCO","ddt.v1", "datt"),
                         mes.cov = list(f1=vect.ps, f2=vect.ttc, f3=vect.tran),
                         time.cov = list(dates, dates, dates2),
                         times = kept.t[[1]])

# Put dates in numeric format with tstart at 0
tabi &lt;- split(SHIlong, SHIlong$id)
L.tabi   &lt;- length(tabi)
tablist &lt;- lapply(1:L.tabi, function(i){
  refstart &lt;- tabi[[i]]$tstart[1]

  tabi[[i]]$tstart  &lt;- tabi[[i]]$tstart - refstart
  tabi[[i]]$tstop &lt;- tabi[[i]]$tstop - refstart
  tabi[[i]]$debttCO &lt;- tabi[[i]]$debttCO - refstart # to be used in next step
  tabi[[i]]$ddt.v1 &lt;- tabi[[i]]$ddt.v1 - refstart # to be used in the final step
  tabi[[i]]$datt &lt;- tabi[[i]]$datt - refstart # to be used in the final step

  return(tabi[[i]])
})
SHIlong &lt;- do.call( rbind, tablist )
colnames(SHIlong)[14:16] &lt;- c("ps", "ttc", "tran")

# Eliminating patient not having initiated the treatment arm
SHIlong2 &lt;- SHIlong[!is.na(SHIlong$ddt.v1),]

# Patients are censored when initiating the other arm treatment, that is, at time swtrtdt
SHIlong2 &lt;- cens.ipw(SHIlong2, id = "id", tstart = "tstart", tstop  = "tstop",
                     event = "event", arm = "bras.f", realtrt = FALSE,
                     censTime ="debttCO")
# We collect all event times 
# (death for both arms and treatment censoring according to the trt arm)
replic.times.MTA &lt;-
    unique(c(SHIlong2$tstop[SHIlong2$cens == 1 &amp;
    SHIlong2$bras.f == "MTA"],
    SHIlong2$tstop[SHIlong2$event == 1]))
replic.times.CT &lt;-
    unique(c(SHIlong2$tstop[SHIlong2$cens == 1 &amp;
    SHIlong2$bras.f == "CT"],
    SHIlong2$tstop[SHIlong2$event == 1]))
# to put times in same order as arms levels
levels(SHIlong2[,"bras.f"])
SHIrep  &lt;- replicRows(SHIlong2, tstart = "tstart", tstop = "tstop",
                      event = "event", cens = "cens", 
                      times1 = replic.times.MTA, times2=replic.times.CT, 
                      arm = "bras.f")

# Estimation of the stabilized weights
library(survival)
SHIres &lt;- ipcw(SHIrep, id = "id", tstart = tstart, tstop = tstop, cens = cens,
               arm = "bras.f", 
               bas.cov = c("agerand", "sex.f", "tt_Lnum", "rmh_alea.c", "pathway.f"),
               conf = c("ps", "ttc", "tran"),
               trunc = 0.05, type = 'kaplan-meier')

# To have conventional therapy (CT) as reference
SHIres$bras.f &lt;- relevel(SHIres$bras.f, ref="CT")

# Using the IPCW weights in Cox likelihood...
fit.stab.w &lt;- coxph(Surv(tstart, tstop, event) ~ bras.f + agerand + sex.f +
                        tt_Lnum + rmh_alea.c + pathway.f
                      + cluster(id),
                      data = SHIres, weights = SHIres$weights.trunc)
fit.stab.w


</code></pre>


</div>