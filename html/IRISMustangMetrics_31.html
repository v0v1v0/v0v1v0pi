<div class="container">

<table style="width: 100%;"><tr>
<td>IRISMustangMetrics-package</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Utilities for calculating seismic metrics from EarthScope (formerly IRIS DMC) data</h2>

<h3>Description</h3>

<p>This package provides S4 classes and functions for calculating metrics from seismological 
data available from EarthScope (<a href="http://ds.iris.edu/ds/nodes/dmc/">http://ds.iris.edu/ds/nodes/dmc/</a>).
This package is part of the MUSTANG project.
</p>


<h3>Introduction</h3>

<p>The <span class="pkg">IRISMustangMetrics</span> package depends upon the <span class="pkg">IRISSeismic</span> package which  defines
new S4 classes and methods for manipulating seismic data.  Please see the "seismic-intro" 
vignette for introductory examples on using <span class="pkg">IRISSeismic</span>.
</p>


<h3>History</h3>

<p>version 2.4.6
</p>

<ul>
<li>
<p>(updated email addresses)
</p>
</li>
<li>
<p>(ISPQAUtils, add psd_corrected metric name to allow the ISPAQ tool to return uncorrected psds)
</p>
</li>
</ul>
<p>version 2.4.5
</p>

<ul>
<li>
<p>(typo fix for email address and updated link in documentation)
</p>
</li>
<li>
<p>(updated error handling code to meet CRAN requirements)
</p>
</li>
</ul>
<p>version 2.4.4
</p>

<ul><li>
<p>(additional error handling for sample_rate_resp)
</p>
</li></ul>
<p>version 2.4.3
</p>

<ul>
<li>
<p>(improved error handling for functions that call IRIS web services)
</p>
</li>
<li>
<p>(additional error handling for sample_rate_resp)
</p>
</li>
</ul>
<p>version 2.4.2
</p>

<ul><li>
<p>minor modification to ISPAQUtils.R for sample_rate_resp, sample_rate_channel
</p>
</li></ul>
<p>version 2.4.1
</p>

<ul>
<li>
<p>fix for max_range where trace length not evenly divided by window length
</p>
</li>
<li>
<p>max_range now rounds window*samplerate and increment*samplerate to integer values
</p>
</li>
<li>
<p>corrects typo error in ISPAQUtils.R
</p>
</li>
</ul>
<p>version 2.4.0
</p>

<ul><li>
<p>adds new metrics sample_rate_resp, sample_rate_channel, max_range
</p>
</li></ul>
<p>version 2.3.0
</p>

<ul>
<li>
<p>modifies PSD metrics for edge case involving metadata and trace start times
</p>
</li>
<li>
<p>adds noCorrection option to PSDMetric, if noCorrection=TRUE it only returns uncorrected 
PSDs and not corrected PSD or PSD-derived metrics; default noCorrection=FALSE
</p>
</li>
</ul>
<p>version 2.2.0
</p>

<ul>
<li>
<p>removes dead_channel_exp, metric has been retired
</p>
</li>
<li>
<p>renames pdf_aggregator in ISPAQUtils.R to pdf
</p>
</li>
</ul>
<p>version 2.1.3
</p>

<ul>
<li>
<p>fixed bug related to getGeneralValueMetrics,getMustangMetrics error handling
</p>
</li>
<li>
<p>added pdf_aggregator to ISPAQUtils.R, for multi-day pdf plotting within ISPAQ
</p>
</li>
</ul>
<p>version 2.1.2
</p>

<ul>
<li>
<p>version 2.1.1 unintentionally removed the pct_above_nhnm metric. This version restores it.
</p>
</li>
<li>
<p>made sample rate sanity rate check consistent between correlationMetric and crossCorrelationMetric
</p>
</li>
</ul>
<p>version 2.1.1
</p>

<ul><li>
<p>fixed bug in PSDMetrics that affected dead_channel_gsn results
</p>
</li></ul>
<p>version 2.1.0
</p>

<ul>
<li>
<p>transfer_function requires sample rates to be within a factor of 10 to avoid decimation effects on amplitude
</p>
</li>
<li>
<p>transfer_function uses 7 order Chebyshev filter in the decimate function, to correct 1% error occurring with default 8 order Chebyshev
</p>
</li>
<li>
<p>fixed bug in transfer_function trace start and end time comparisons
</p>
</li>
<li>
<p>transfer_function when determining if sample rate &lt; 1, round to 5 digits first
</p>
</li>
<li>
<p>getGeneralValueMetrics added metric_error, ts_channel_continuity, ts_channel_up_time, ts_gap_length, ts_gap_length_total, ts_max_gap, 
ts_max_gap_total, ts_num_gaps, ts_num_gaps_total, ts_percent_availability, ts_percent_availability metrics
</p>
</li>
<li>
<p>aliased the getGeneralValueMetrics function to getMustangMetrics
</p>
</li>
<li>
<p>dailyDCOffsetMetric now returns error when result is NaN or NA
</p>
</li>
</ul>
<p>version 2.0.9
</p>

<ul>
<li>
<p>removed dependency on pracma package
</p>
</li>
<li>
<p>removed channel restrictions for pct_above_nhnm,pct_below_nlm
</p>
</li>
<li>
<p>cross correlation sampling rates of &lt; 1 will round to 2 digits
</p>
</li>
<li>
<p>getGeneralValueMetrics better handles case of no targets found
</p>
</li>
<li>
<p>improved error handling in spikesMetric.R
</p>
</li>
</ul>
<p>version 2.0.8
</p>

<ul><li>
<p>minor bug fix to ISPAQUtils.R, spikes=numSpikes
</p>
</li></ul>
<p>version 2.0.7
</p>

<ul>
<li>
<p>fixed bug in getGeneralValueMetrics that didn't return measurements if there was more than one for any day
</p>
</li>
<li>
<p>crossCorrelationMetric filter now defaults to a butterworth 2 pole 0.1Hz (10 second) low pass filter
</p>
</li>
</ul>
<p>version 2.0.6
</p>

<ul><li>
<p>fixed bug related to NA -&gt; NULL replacement in Class-Metric
</p>
</li></ul>
<p>version 2.0.5
</p>

<ul><li>
<p>fixed dplyr version dependencies
</p>
</li></ul>
<p>version 2.0.4
</p>

<ul>
<li>
<p>adds additional sanity check to <code>getGeneralValueMetrics()</code>
</p>
</li>
<li>
<p>createBssUrl() adds "&amp;nodata=404" to url
</p>
</li>
</ul>
<p>version 2.0.2
</p>

<ul><li>
<p>updates to ISPAQUtils.R
</p>
</li></ul>
<p>version 2.0.1
</p>

<ul><li>
<p>removed dependency on tidyr package
</p>
</li></ul>
<p>version 2.0.0 – GeneralValueMetrics
</p>

<ul>
<li>
<p><code>GeneralValueMetric</code> class introduced, <code>SingleValueMetric</code> class deprecated. All metrics that previously returned
<code>SingleValueMetric</code> now return <code>GeneralValueMetric</code>
</p>
</li>
<li>
<p><code>getGeneralValueMetrics()</code> function added. Retreives metrics measurements from BSS database
</p>
</li>
<li>
<p><code>crossCorrelationMetric()</code> does not return timing_drift. The metric proved unreliable
</p>
</li>
<li>
<p>users can now supply instrument response information in the form of frequency, amplitude, phase
to the function <code>PSDMetric</code>, in place of the getEvalresp webservice call
</p>
</li>
</ul>
<p>version 1.3.1 – PSDs
</p>

<ul><li>
<p><code>getPsdMetrics</code> reworked
</p>
</li></ul>
<p>version 1.3.0 – latency
</p>

<ul>
<li>
<p><code>getLatencyValuesXML()</code> removed from package.
</p>
</li>
<li>
<p>documentation improvements.
</p>
</li>
<li>
<p>additional error checking for <code>getSingleValueMetrics()</code>.
</p>
</li>
</ul>
<p>version 1.2.7 – PSDs
</p>

<ul><li>
<p><code>PSDMetrics()</code> metrics <code>percent_above_nhnm</code> and <code>percent_below_nlnm</code> limited to frequencies less than nyquist/1.5.
</p>
</li></ul>
<p>version 1.2.6 – PSDs
</p>

<ul>
<li>
<p>Depends on <span class="pkg">IRISSeismic</span> (&gt;= 1.3.0).
</p>
</li>
<li>
<p><code>dead_channel_exp</code> and <code>dead_channel_lin</code> metrics will only return values for station channel codes matching "BH|HH".
</p>
</li>
</ul>
<p>version 1.2.5 – ISPAQUtils
</p>

<ul><li>
<p>ISPAQUtils.R contains functions for use with the ISPAQ standalone metrics system.
</p>
</li></ul>
<p>version 1.2.4 – package version dependencies
</p>

<ul><li>
<p>Depends on <span class="pkg">IRISSeismic</span> (&gt;= 1.2.3). Imports <span class="pkg">seismicRoll</span> (&gt;=1.1.2).
</p>
</li></ul>
<p>version 1.2.2 – correlationMetric tweak
</p>

<ul><li>
<p><code>correlationMetric()</code> allows trace sample lengths to differ by 2 samples without stopping.
</p>
</li></ul>
<p>version 1.2.1 – PSDs
</p>

<ul>
<li>
<p>Better fix to very low powers issue in <code>PSDMetrics()</code> <code>dead_channel_gsn</code> metric.
</p>
</li>
<li>
<p><code>PSDMetrics()</code> shifts PDF bin centers by 0.5 dB.
</p>
</li>
</ul>
<p>version 1.2.0 – PSDs
</p>

<ul>
<li>
<p><code>PSDMetric()</code> returns corrected PSD and PDF dataframes in addition to uncorrected PSDs and PSD derived metrics.
</p>
</li>
<li>
<p>Depends on R (&gt;= 3.2.0) and <span class="pkg">IRISSeismic</span> (&gt;=1.1.7).
</p>
</li>
<li>
<p>Imports <span class="pkg">tidyr</span>, <span class="pkg">dplyr</span>.
</p>
</li>
</ul>
<p>version 1.1.3 – bug fix, import version increased
</p>

<ul>
<li>
<p>Fixes typo in <code>SNRMetric()</code> function <code>windowSecs</code> argument default value.
</p>
</li>
<li>
<p>Imports <span class="pkg">seismicRoll</span> (&gt;=1.1.1)
</p>
</li>
</ul>
<p>version 1.1.2 – modifications
</p>

<ul>
<li>
<p>Improves error handling messages.
</p>
</li>
<li>
<p><code>dailyDCOffsetMetric()</code> removes unused selectivity argument and adds argument controlling output type.
</p>
</li>
<li>
<p>Fixes bug in <code>dailyDCOffsetMetrics()</code> related to outlier removal and vector length.
</p>
</li>
<li>
<p>Fixes bug in <code>PSDMetrics()</code> <code>dead_channel_gsn</code> metric related to very low power values.
</p>
</li>
<li>
<p><code>PSDMetrics()</code> only returns metrics that generate numeric values.
</p>
</li>
</ul>
<p>version 1.1.1 – bug fix
</p>

<ul><li>
<p><code>crossCorrelationMetric()</code> exits if either input trace is flatlined (all values equal).
</p>
</li></ul>
<p>version 1.1.0 – updates package dependencies
</p>

<ul><li>
<p>Depends on <span class="pkg">IRISSeismic</span> (&gt;= 1.1.0).
</p>
</li></ul>
<p>version 1.0.8 – new metric and bug fix
</p>

<ul>
<li>
<p>Improves error handling messages.
</p>
</li>
<li>
<p>Adds new <code>dead_channel_gsn</code> metric to <code>PSDMetric()</code> function output.
</p>
</li>
<li>
<p>Fixes bug in <code>STALTAMetric()</code> involving required trace length.
</p>
</li>
</ul>
<p>version 1.0.7 – bug fix
</p>

<ul><li>
<p>Fixes issue with <code>spikesMetric()</code> passing argument values to <code>findOutliers</code>.
</p>
</li></ul>
<p>version 1.0.6 – function argument changes
</p>

<ul>
<li>
<p>Changes <code>spikesMetric()</code> default argument values <code>thresholdMin=10</code>,<code>selectivity=NA</code>,<code>fixedThreshold=TRUE</code>.
</p>
</li>
<li>
<p><code>transferFunctionMetric()</code> now requires input of evalresp fap spectra, new arguments <code>evalresp1</code> and <code>evalresp2</code>.
</p>
</li>
<li>
<p>Additional sanity checks for <code>transferFunctionMetric()</code> and <code>PSDMetric()</code>.
</p>
</li>
<li>
<p>Depends on <span class="pkg">IRISSeismic</span> (&gt;= 1.0.10). Imports <span class="pkg">seismicRoll</span> (&gt;=1.1.0). Imports <span class="pkg">stats</span>.
</p>
</li>
</ul>
<p>version 1.0.5 – new PSD metric
</p>

<ul>
<li>
<p>Changes URL syntax for MUSTANG web services to use "format=..." instead of "output=...".
</p>
</li>
<li>
<p>Adds new <code>sample_unique</code> metric to <code>PSDMetric()</code> output.
</p>
</li>
</ul>
<p>version 1.0.3 – new functionality and bug fixes
</p>

<ul>
<li>
<p>Adds new <code>metricList2DF()</code> function.
</p>
</li>
<li>
<p>Adds new <code>dead_channel_lin</code> metric to <code>PSDMetric()</code> output.
</p>
</li>
<li>
<p>Fixes typo in <code>Class-Metric.R</code> value string format.
</p>
</li>
</ul>
<p>version 1.0.0 – First Public Release
</p>


<h3>Author(s)</h3>

<p>Jonathan Callahan <a href="mailto:jonathan@mazamascience.com">jonathan@mazamascience.com</a>
</p>


<h3>References</h3>

<p>IRIS DMC web services: <a href="http://service.iris.edu/">http://service.iris.edu/</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Open a connection to IRIS DMC webservices
iris &lt;- new("IrisClient", debug=TRUE)

# Get the seismic data
starttime &lt;- as.POSIXct("2010-02-27 06:45:00",tz="GMT")
endtime &lt;- as.POSIXct("2010-02-27 07:45:00",tz="GMT")
result &lt;- try(st &lt;- getDataselect(iris,"IU","ANMO","00","BHZ",starttime,endtime))
if (class(result) == "try-error" ) {
   print(geterrmessage())
} else {
   # Apply a metric and show the results
   metricList &lt;- basicStatsMetric(st)
   dummy &lt;- lapply(metricList, show)
}
</code></pre>


</div>