<div class="container">

<table style="width: 100%;"><tr>
<td>plot_pca_surface</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Visualization of the effect predictors in nonlinear interactions with 
principled components.</h2>

<h3>Description</h3>

<p>Produces perspective or contour plot views of gam model 
predictions of the additive effects interactions.
The code is based on the script for <code>vis.gam</code>, 
but allows to cancel random effects.
</p>


<h3>Usage</h3>

<pre><code class="language-R">plot_pca_surface(
  x,
  pca.term = NULL,
  weights = NULL,
  view = NULL,
  cond = list(),
  partial = FALSE,
  select = NULL,
  se = -1,
  n.grid = 30,
  too.far = 0,
  rm.ranef = NULL,
  col = NA,
  color = "topo",
  contour.col = NULL,
  nCol = 50,
  plotCI = FALSE,
  add.color.legend = TRUE,
  plot.type = "contour",
  xlim = NULL,
  ylim = NULL,
  zlim = NULL,
  print.summary = getOption("itsadug_print"),
  transform = NULL,
  transform.view = NULL,
  hide.label = FALSE,
  dec = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A gam object, produced by <code>gam</code> or 
<code>bam</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pca.term</code></td>
<td>
<p>Text string, name of model predictor that represents a 
principle component.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>Named list with the predictors that are combined in the PC 
and their weights. See examples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>view</code></td>
<td>
<p>A two-value vector containing the names of the two terms to 
plot. The two terms should be part of the PC. Note that 
variables coerced to factors in the model formula won't work as view 
variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cond</code></td>
<td>
<p>A named list of the values to use for the other predictor 
terms (not in view). Used for choosing between smooths that share the 
same view predictors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>partial</code></td>
<td>
<p>Logical value: whether or not to plot the partial effect 
(TRUE) or the summed effect (FALSE, default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>select</code></td>
<td>
<p>Numeric value, model term. In case <code>partial=TRUE</code> a 
model term needs to be selected.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se</code></td>
<td>
<p>If less than or equal to zero then only the predicted surface 
is plotted, but if greater than zero, then 3 surfaces are plotted, one at 
the predicted values minus se standard errors, one at the predicted 
values and one at the predicted values plus se standard errors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.grid</code></td>
<td>
<p>The number of grid nodes in each direction used for 
calculating the plotted surface.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>too.far</code></td>
<td>
<p>Plot grid nodes that are too far from the points defined by 
the variables given in view can be excluded from the plot. too.far 
determines what is too far. The grid is scaled into the unit square along 
with the view variables and then grid nodes more than too.far from the 
predictor variables are excluded.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rm.ranef</code></td>
<td>
<p>Logical: whether or not to remove random effects. 
Default is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col</code></td>
<td>
<p>The colors for the facets of the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color</code></td>
<td>
<p>The color scheme to use for plots. One of 'topo', 'heat', 
'cm', 'terrain', 'gray' or 'bw'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>contour.col</code></td>
<td>
<p>sets the color of contours when using plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nCol</code></td>
<td>
<p>The number of colors to use in color schemes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotCI</code></td>
<td>
<p>Logical: whether or not to plot the confidence intervals. 
The value of <code>se</code> determines the size of the CI.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add.color.legend</code></td>
<td>
<p>Logical: whether or not to add a color legend. 
Default is TRUE. If FALSE (omitted), one could use the function
<code>gradientLegend</code> to add a legend manually at any position.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot.type</code></td>
<td>
<p>one of 'contour' or 'persp' (default is 'contour').</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlim</code></td>
<td>
<p>A two item array giving the lower and upper limits for the x-
axis scale. NULL to choose automatically.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylim</code></td>
<td>
<p>A two item array giving the lower and upper limits for the y-
axis scale. NULL to choose automatically.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zlim</code></td>
<td>
<p>A two item array giving the lower and upper limits for the z-
axis scale. NULL to choose automatically.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.summary</code></td>
<td>
<p>Logical: whether or not to print a summary.
Default set to the print info messages option 
(see <code>infoMessages</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transform</code></td>
<td>
<p>Function for transforming the fitted values. 
Default is NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transform.view</code></td>
<td>
<p>List with two functions for transforming 
the values on the x- and y-axis respectively. If one of the axes 
need to be transformed, set the other to NULL (no transformation).
See examples below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hide.label</code></td>
<td>
<p>Logical: whether or not to hide the label 
(i.e., 'fitted values'). Default is FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dec</code></td>
<td>
<p>Numeric: number of decimals for rounding the color legend. 
When NULL, no rounding (default). If -1, automatically determined.  
Note: if value = -1, rounding will be applied also when 
<code>zlim</code> is provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other options to pass on to persp, image or contour. In 
particular ticktype='detailed' will add proper axes labeling to the plots.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Jacolien van Rij
data(simdat)
# add hypothetical correlated term:
simdat$predictor &lt;-  (simdat$Trial+10)^.75 + rnorm(nrow(simdat))
# principal components analysis:
pca &lt;- prcomp(simdat[, c('Trial', 'predictor')])
# only first PC term contributes:
summary(pca)
# get rotation (weights of predictors in PC):
pcar &lt;- pca$rotation
# add PC1 to data:
simdat$PC1 &lt;- pca$x[,1]
</p>
<p># model:
m1 &lt;- bam(Y ~ Group + te(Time, PC1, by=Group) 
+ s(Time, Subject, bs='fs', m=1, k=5), data=simdat)
# inspect surface:
fvisgam(m1, view=c('Time', 'PC1'), cond=list(Group='Children'),
rm.ranef=TRUE)
# how does Trial contribute?
plot_pca_surface(m1, pca.term='PC1', weights=pcar[,'PC1'], 
view=c('Time', 'Trial'), cond=list(Group='Children'),rm.ranef=TRUE)
# Note that the range of Trial is estimated based on the values of PC1.
# A better solution is to specify the range:
plot_pca_surface(m1, pca.term='PC1', weights=pcar[,'PC1'], 
view=list(Time=range(simdat$Time), Trial=range(simdat$Trial)), 
cond=list(Group='Children'),rm.ranef=TRUE)
</p>
<p># Partial effects:
pvisgam(m1, view=c('Time', 'PC1'), cond=list(Group='Children'),
select=1, rm.ranef=TRUE)
# PCA:
plot_pca_surface(m1, pca.term='PC1', weights=pcar[,'PC1'], 
partial=TRUE, select=1,
view=list(Time=range(simdat$Time), Trial=range(simdat$Trial)), 
cond=list(Group='Children'))
</p>


<h3>See Also</h3>

<p><code>fvisgam</code>, <code>pvisgam</code>
</p>
<p>Other Functions for PCA interpretation: 
<code>get_pca_predictions()</code>
</p>


</div>